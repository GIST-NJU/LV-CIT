# A Combinatorial Interaction Testing Method for Multi-Label Image Classifier

## DNN Models Under Test:

| DNN Models | Dataset |
| :---: | :---: |
| [MSRN](https://github.com/chehao2628/MSRN) | VOC, COCO |
| [ML-GCN](https://github.com/megvii-research/ML-GCN) | VOC, COCO |
| [ASL](https://github.com/Alibaba-MIIL/ASL) | VOC, COCO |

## File Structure

```
.
├─data  # Data and results directory (images except the object libraries omitted due to limited storage space)
│  ├─combine  # images and results of LV-CIT
|  |  ├─0source_img/testset  # source images from voc/coco, split into different dictionaries by labels (omitted)
|  |  |  ├─VOC
|  |  |  |  ├─aeroplane  # images
|  |  |  |  └─...
|  |  |  └─COCO
|  |  |     ├─airplane  # images
|  |  |     └─...
|  |  ├─1covering_array  # covering arrays generated by three algorithms (LV-CIT, Baseline, and ACTS)
|  |  |  ├─adaptive random  # covering arrays generated by LV-CIT
|  |  |  ├─baseline  # covering arrays generated by Baseline
|  |  |  └─acts  # covering arrays generated by ACTS
|  |  ├─2matting_img/testset  # matting images by [YOLACT++](https://github.com/dbolya/yolact) from source images
|  |  |  ├─VOC_output  # YOLACT++ output of VOC images (omitted)
|  |  |  ├─VOC_output_model_any_pass  # results of first validation by DNN models (omitted)
|  |  |  ├─VOC_library  # object libraries of VOC images (results of second valudation by human)
|  |  |  ├─COCO_output  # YOLACT++ output of COCO images
|  |  |  ├─COCO_output_model_any_pass  # results of first validation by DNN models (omitted)
|  |  |  └─COCO_library  # object libraries of COCO images (results of second valudation by human) (omitted)
|  |  ├─3combine_img  # composite images by LV-CIT (omitted)
|  |  |  ├─VOC_20_v6_random_255_255_255_255_s1a0  # composite images of VOC by LV-CIT
|  |  |  └─COCO_80_v6_random_255_255_255_255_s1a0  # composite images of COCO by LV-CIT
|  |  ├─4results  # model outputs
|  |  |  ├─VOC_20_v6_random_255_255_255_255_s1a0  # results of different models on VOC
|  |  |  ├─COCO_80_v6_random_255_255_255_255_s1a0  # results of different models on COCO
|  |  |  └─google  # results of ATOM provided by its authors
|  |  └─5res_analyse  # results of RQ1-RQ3
|  ├─coco # COCO2014 dataset (omitted)
|  └─voc # VOC2007 dataset (omitted)
├─checkpoints (omitted)  # checkpoints released by authors of DNN models (see DNN Models Under Test)
|  └─org
|     ├─msrn
|     ├─asl
|     └─mlgcn
├─pretrained (omitted)  # pretrained model of MSRN (see DNN Models Under Test)
|  └─resnet101_for_msrn.pth.tar
├─models  # for DNN models under test
├─dataloaders  # dataloaders for different datasets
├─result_analyse  # for analysing results
├─ca_generator.py  # for generating covering arrays by LV-CIT and Baseline
├─check_libraries.py  # for first validation step by DNN models (to build the object libraries)
├─combiner.py  # for generating composite images
├─combine_main.py  # for executing the tests for composite images
├─combine_runner.py
├─default_main.py  # for executing the tests for VOC/COCO test(validation) sets to get outputs of Random method
├─default_runner.py
├─compare_random_select.py  # for selecting the random outputs from the outputs of Random method
├─util.py
├─requirements.txt
└─README.md
```

## How to Run

### Step 0: Prepare Datasets and Models

- Download the [VOC2007](http://host.robots.ox.ac.uk/pascal/VOC/voc2007/) and [COCO2014](https://cocodataset.org) datasets and put them in the `data` directory.
- Download the checkpoints of the DNN models under test and put them in the `checkpoints` or `pretrained` directory.
- Download our released [object libraries](https://drive.google.com/drive/folders/1_z7JdSVLbSxoTLke3J6249HhtKztXlhj) and put them in the `data/combine/2matting_img/testset` directory.

### Step 1: Generate Covering Arrays

```bash
python ca_generator.py
```

### Step 2: Build Object Libraries (can be skipped if you downloaded our released object libraries)

- Generate Matting Images

see [YOLACT++](https://github.com/dbolya/yolact), saving the matting images in `data/combine/2matting_img/testset/<dataset>_output`, where `<dataset>` is `VOC` or `COCO`.

- sample by DNN models

```bash
python check_libraries.py
```

- sample by human

The object libraries are saved in `data/combine/2matting_img/testset/<dataset>_library`, where `<dataset>` is `VOC` or `COCO`.

### Step 3: Generate Composite Images

Execute the following command and the composite images will be saved in `data/combine/3combine_img`, using the covering arrays generated in Step 1 and the object libraries generated in Step 2.

```bash
python combiner.py
```

### Step 4: Execute Tests

```bash
python combine_main.py  # test all the DNN models on the composite images
python default_main.py  # test all the DNN models on the VOC/COCO test(validation) sets to get outputs of Random method
python compare_random_select.py  # randomly select outputs from the outputs of default test sets as the outputs of Random method
```

### Step 5: Result Analysis

Execute the following commands to get the figures and tables in the paper.

```bash
python result_analyse/plot.py
python result_analyse/ana_atom_info.py
python result_analyse/ana_train_val_info.py
python result_analyse/analyse.py
```
